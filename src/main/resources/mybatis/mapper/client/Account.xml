<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ailu.tokenmedia.client.dao.AccountDao">

	<select id="getAccounts" resultType="com.ailu.tokenmedia.client.dto.AccountDTO">
		SELECT w.id,w.wechatid,d.biz_name,d.fans,d.logurl,first_avg_read weekReadMean,
		first_avg_read*7 weekReadCount,article_count weekPushCount,w.biz_name
		FROM wechat w
		LEFT JOIN article a ON w.wechatid=a.wechatid
		LEFT JOIN diagnosis d ON w.wechatid=d.wechatid
		GROUP BY w.wechatid
		ORDER BY d.fans desc,weekReadMean DESC,weekReadCount desc,weekPushCount desc
		limit #{start},#{length}
	</select>
	
	<select id="getCount" resultType="int">
		select count(0) FROM wechat 
	</select>
	
	<select id="getDetail" resultType="com.ailu.tokenmedia.client.dto.AccountDetailDTO">
		SELECT w.id,w.wechatid,w.qrcode,d.biz_name,d.logurl,d.iz_desc,d.fans,d.first_avg_read,
		d.second_avg_read,d.third_more_avg_read
		FROM wechat w LEFT JOIN diagnosis d ON w.wechatid=d.wechatid
		where w.id=#{id}
	</select>

</mapper>